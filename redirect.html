<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>T-NGON - Gọi món</title>

  <!-- cố định scale, không cho zoom -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
  <meta name="theme-color" content="#3b82f6" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

  <link rel="manifest" href="./redirect.webmanifest" />
  <link rel="icon" href="./icons/icon-192.png" />

  <!-- Tailwind (optional) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- ===== CSS: safe-area + notch-aware vars ===== -->
  <style>
    :root {
      --pos-top: 0px;
      --pos-height-calc: 100vh;
    }

    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      background: #f3f4f6;
      -webkit-font-smoothing:antialiased;
      -webkit-touch-callout: none;
    }

    /* app-wide safe-area helper (dùng cho màn chọn / start) */
    .use-safe-area {
      padding-top: env(safe-area-inset-top, 12px);
      padding-left: env(safe-area-inset-left, 12px);
      padding-right: env(safe-area-inset-right, 12px);
      padding-bottom: env(safe-area-inset-bottom, 12px);
      box-sizing: border-box;
    }

    /* POS iframe: mặc định full-bleed; biến --pos-top thay đổi nếu có notch */
    #pos-container {
      position: fixed;
      top: var(--pos-top);
      left: 0;
      width: 100vw;
      height: var(--pos-height-calc);
      z-index: 1000;
      background: #fff;
      display: none;
    }
    #pos-container.is-shown { display: block; }
    #pos-frame { width: 100%; height: 100%; border: 0; display: block; }

    /* Khi đã detect có notch, state.js sẽ thêm class .has-notch lên body
       và CSS biến --pos-top / --pos-height-calc sẽ dùng env(safe-area-inset-top) */
    body.has-notch {
      --pos-top: env(safe-area-inset-top, 20px);
      --pos-height-calc: calc(100vh - env(safe-area-inset-top, 20px));
    }

    /* Select / Start screens layout */
    #select-table, #start-screen {
      width: 100%;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 1rem;
    }
    #start-screen { display: none; }
    #start-screen.is-shown { display: flex; }

    /* Big table number (responsive) */
    #selected-table {
      font-weight: 800;
      color: #000;
      line-height: 1;
      margin-bottom: 1rem;
      text-align: center;
      font-size: min(60vw, 60vh); /* very big; tune as needed */
    }

    /* START button: 5:2 proportion (height = 15vh, width ~ 2.5 * height) */
    #start-order {
      height: 15vh;
      width: min(80vw, 37.5vh);
      border-radius: 1rem;
      font-weight: 800;
      font-size: clamp(20px, 5vh, 48px);
      display: flex;
      align-items: center;
      justify-content: center;
      background: #0ea5e9; /* blue-500 */
      color: white;
      box-shadow: 0 6px 18px rgba(2,6,23,0.12);
    }

    /* Table grid */
    #table-container {
      display: grid;
      justify-content: center;
      gap: 1rem;
      padding: 0 1rem;
      grid-template-columns: repeat(2, minmax(0,1fr));
    }
    @media(min-width:640px){ #table-container { grid-template-columns: repeat(3, 1fr); } }
    @media(min-width:768px){ #table-container { grid-template-columns: repeat(4, 1fr); } }
    @media(min-width:1024px){ #table-container { grid-template-columns: repeat(5, 1fr); } }

    .table-btn {
      display:flex; align-items:center; justify-content:center;
      padding: 1rem; border-radius: 0.75rem; font-weight:800;
      background: #0369a1; color:#fff; /* blue-800 -> use this for visible dark-blue */
      font-size: clamp(18px, 3.5vw, 28px);
      min-height: 5.25rem;
      user-select: none;
    }
    .table-btn:active { transform: translateY(1px); }

    /* Secret button left (transparent & click-through except pointer-events) */
    .secret-btn {
      position: fixed;
      bottom: 10px;
      left: 8px;
      width: 96px;
      height: 96px;
      background: transparent;
      border: 0;
      z-index: 2200;
      opacity: 0;
      pointer-events: auto; /* clickable despite opacity */
    }

    /* Blackout overlay */
    #screen-overlay {
      position: fixed;
      inset: 0;
      background: #000;
      z-index: 2000;
      display: none;
    }

    /* Prevent selection/copy except inputs */
    * { -webkit-user-select: none; user-select: none; -webkit-touch-callout: none; }
    input, textarea, select, [contenteditable="true"] { -webkit-user-select: text; user-select: text; -webkit-touch-callout: default; }
  </style>
</head>
<body class="use-safe-area">

  <!-- Bước 1: Chọn bàn -->
  <div id="select-table" class="use-safe-area">
    <h1 class="text-3xl font-bold text-blue-600">Vui lòng chọn bàn</h1>
    <div id="table-container" class="mt-6"></div>
  </div>

  <!-- Bước 2: Màn bắt đầu -->
  <div id="start-screen" class="use-safe-area" aria-hidden="true">
    <div id="selected-table" aria-live="polite"></div>
    <button id="start-order">START ORDER</button>
  </div>

  <!-- Bước 3: POS iframe -->
  <div id="pos-container" aria-hidden="true">
    <iframe id="pos-frame" referrerpolicy="no-referrer" sandbox="allow-forms allow-scripts allow-same-origin allow-popups"></iframe>
  </div>

  <!-- Popup nhập mật mã -->
  <div id="password-popup" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-[2200]">
    <div class="bg-white p-6 rounded-lg shadow-lg text-center">
      <h3 class="text-lg font-semibold mb-4">Nhập mật mã</h3>
      <input id="password-input" type="password" maxlength="4" class="border p-2 rounded text-center tracking-widest text-xl" placeholder="****" inputmode="numeric" />
      <div class="mt-4 flex justify-center space-x-4">
        <button id="password-ok" class="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600">OK</button>
        <button id="password-cancel" class="px-4 py-2 bg-gray-300 rounded hover:bg-gray-400">Hủy</button>
      </div>
      <p id="password-error" class="text-red-500 mt-2 hidden">Sai mật mã!</p>
    </div>
  </div>

  <!-- Màn đen -->
  <div id="screen-overlay" aria-hidden="true"></div>

  <!-- Nút bí mật (left) -->
  <button id="back-btn-start" class="secret-btn" aria-label="hidden-back-start"></button>

  <!-- Load scripts: state.js must load early (detect notch & helpers) -->
  <script src="./assets/js/state.js?v=2"></script>
  <script src="./assets/js/redirect.js?v=2"></script>
  <script src="./assets/js/secret-btn.js?v=2"></script>

  <!-- Firebase libs (blackout uses firebase) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>

  <script src="./assets/js/blackout.js?v=2"></script>
  <script src="./assets/js/nosleep.js?v=2"></script>
  <script src="./assets/js/sw-register.js?v=2"></script>

  <!-- small runtime: ensure START button label is consistent and prevents double-tap zoom -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const b = document.getElementById('start-order');
      if (b) b.textContent = 'START ORDER';
      // Prevent pinch/double tap zoom
      document.addEventListener('touchstart', function (e) { if (e.touches && e.touches.length > 1) e.preventDefault(); }, {passive:false});
      document.addEventListener('gesturestart', function (e) { e.preventDefault(); }, {passive:false});
      document.addEventListener('dblclick', (e) => e.preventDefault(), {passive:false});
    });
  </script>

</body>
</html>
