<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<title>Ki·ªÉm kho T-NGON</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="stylesheet" href="styles.css">
<!-- Th∆∞ vi·ªán t·∫°o XLSX cho KiotViet -->
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>
<body>
<h1>App ki·ªÉm kho</h1>

<!-- Tab navigation -->
<div class="tab-navigation">
  <button class="tab-button active" data-tab="main">KI·ªÇM KHO</button>
  <button class="tab-button" data-tab="export">XU·∫§T/NH·∫¨P</button>
</div>

<!-- Main Tab -->
<div id="main-tab" class="tab-content active">
  <!-- Form nh·∫≠p li·ªáu ch√≠nh -->
  <div class="field">
    <label>M√£ v·∫°ch:</label>
   <div class="inline-row" style="--ch:20ch;">
  <input id="barcodeInput" class="barcode-input fixed-ch" maxlength="15" autofocus />
  <button id="cameraBtn" type="button">üì∑</button>
  <button id="editBarcodeModeBtn" type="button">‚úèÔ∏è S·ª≠a m√£</button>
</div>
    <video id="cameraPreview" class="camera-preview" autoplay playsinline></video>
    <button id="stopCameraBtn" type="button">T·∫Øt camera qu√©t</button>
  </div>

  <div class="field">
  <label>T√™n s·∫£n ph·∫©m:</label>
  <div class="inline inline-row" style="--ch: 20ch;">
    <input id="nameInput" class="fixed-ch" />
    <button id="searchNameBtn" type="button">üîç T√¨m</button>

    <!-- ‚úÖ N√∫t in tem #1 (GI·ªÆ 1 ID DUY NH·∫§T) -->
    <button id="printLabelBtn" class="print-label-btn" data-print-label="1" type="button">üñ®In tem gi√°</button>
  </div>
  <div id="searchResults" class="search-results"></div>
</div>

<div class="field">
  <label>·∫¢nh s·∫£n ph·∫©m:</label>
  <div class="inline inline-row" style="--ch: 20ch;">
    <input id="imageInput" class="fixed-ch" placeholder="Base64 ho·∫∑c URL" />
    <button id="photoBtn" type="button">üì∏ Ch·ª•p ·∫£nh</button>
  </div>

  <div id="photoFrame" class="photo-frame">
    <video id="photoPreview" class="photo-preview" autoplay playsinline></video>
  </div>

  <button id="takePhotoBtn" type="button">Ch·ª•p & l∆∞u v√†o form</button>
  <button id="closePhotoBtn" type="button">ƒê√≥ng camera ·∫£nh</button>
  <canvas id="photoCanvas" style="display:none;"></canvas>
  <img id="imageThumb" class="img-thumb" alt="·∫¢nh s·∫£n ph·∫©m" />
</div>

  <div class="field">
    <label>Danh m·ª•c / Tags:</label>
    <div class="inline">
      <div class="category-wrapper" style="flex:1;">
        <input id="categoryInput" placeholder="Ch·ªçn ho·∫∑c g√µ danh m·ª•c..." autocomplete="off" />
        <div id="categoryDropdown" class="category-dropdown"></div>
      </div>
      <div class="tags-wrapper" style="flex:1;">
        <div id="tagsDisplay" class="tags-display tags-placeholder">
          + Ch·ªçn / th√™m tag
        </div>
        <div id="tagsDropdown" class="tags-dropdown"></div>
      </div>
    </div>
  </div>

  <div class="field">
    <label>S·ªë l∆∞·ª£ng / T·ªìn kho / Gi√° b√°n:</label>
    <div class="inline small-input-row">
      <input id="qtyInput" type="number" value="1" min="0" class="short-input" placeholder="SL" data-numpad="1" />
      <input id="stockInput" type="number" min="0" class="short-input" placeholder="T·ªìn" data-numpad="1" />
      <input id="priceInput" type="number" min="0" step="1" class="short-input" placeholder="Gi√°" data-numpad="1" />
    </div>
  </div>

  <div class="field">
    <label>Ghi ch√∫:</label>
    <input id="noteInput" />
  </div>

  <div class="field">
    <div>
      <button id="saveBtn" type="button">L∆∞u / Th√™m m·ªõi</button>
      <button id="resetBtn" type="button">X√≥a form</button>

      <!-- ‚úÖ N√∫t in tem #2 (KH√îNG D√ôNG ID N·ªÆA, CH·ªà D√ôNG CLASS/DATA) -->
      <button class="print-label-btn" data-print-label="1" type="button">üñ® In tem gi√°</button>

      <button id="deleteItemBtn" type="button">üóë X√≥a h√†ng h√≥a</button>
      <button id="countModeBtn" type="button">üì¶ KI·ªÇM ƒê·∫æM</button>
    </div>
  </div>

  <!-- B·∫£ng d·ªØ li·ªáu -->
  <div class="field">
    <button id="inlineEditToggleBtn" type="button">‚úèÔ∏è S·ª≠a tr·ª±c ti·∫øp b·∫£ng</button>
  </div>

  <table>
    <thead>
      <tr>
        <th>#</th>
        <th data-key="barcode">M√£ v·∫°ch</th>
        <th data-key="name">T√™n s·∫£n ph·∫©m</th>
        <th>·∫¢nh</th>
        <th data-key="category">Danh m·ª•c</th>
        <th data-key="tags">Tags</th>
        <th data-key="price">Gi√° b√°n</th>
        <th data-key="qty">S·ªë l∆∞·ª£ng</th>
        <th data-key="stock">T·ªìn kho</th>
        <th>Ghi ch√∫</th>
        <th>C·∫≠p nh·∫≠t</th>
        <th>X√≥a</th>
      </tr>
    </thead>
    <tbody id="itemsBody"></tbody>
  </table>
</div>

<!-- Export/Import Tab -->
<div id="export-tab" class="tab-content">
  <div class="field">
    <label>Import CSV hi·ªán c√≥ (t·ª´ file m√°y):</label>
    <input id="csvFileInput" type="file" accept=".csv" />
    <div class="small">
      CSV chu·∫©n (m·ªõi): <b>M√£ v·∫°ch,T√™n s·∫£n ph·∫©m,·∫¢nh,Danh m·ª•c,Tags,Gi√° b√°n,S·ªë l∆∞·ª£ng,T·ªìn kho,Ghi ch√∫,C·∫≠p nh·∫≠t l√∫c</b><br>
      File c≈© (kh√¥ng c√≥ c·ªôt Tags) v·∫´n ƒë·ªçc ƒë∆∞·ª£c b√¨nh th∆∞·ªùng.
    </div>
  </div>

  <div class="field">
    <div>
      <button id="exportBtn" type="button">Export CSV (t·∫£i file v·ªÅ m√°y)</button>
      <button id="exportShopifyBtn" type="button">CSV cho Shopify</button>
      <button id="exportKiotVietBtn" type="button">XLSX cho KiotViet</button>
      <button id="githubPullBtn" type="button">‚¨á T·∫£i CSV t·ª´ GitHub</button>
      <button id="githubPushBtn" type="button">‚¨Ü L∆∞u CSV l√™n GitHub (k√®m upload ·∫£nh)</button>
      <button id="btnSyncKiotviet" type="button">L∆∞u h√†ng M·ªöI / M·ªöI S·ª¨A l√™n KiotViet</button>
      <button id="btnSyncKiotvietAll" type="button">L∆∞u TO√ÄN B·ªò l√™n KiotViet</button>
      <span id="syncKiotvietStatus" style="font-size:12px;margin-left:8px;"></span>
    </div>
    <div class="small">
      L·∫ßn ƒë·∫ßu d√πng GitHub s·∫Ω h·ªèi token (PAT) ‚Üí l∆∞u tr√™n thi·∫øt b·ªã (localStorage).<br>
      D·ªØ li·ªáu c≈©ng ƒë∆∞·ª£c l∆∞u t·∫°m trong tr√¨nh duy·ªát (localStorage) nh∆∞ tr∆∞·ªõc.
    </div>
  </div>
</div>

<dialog id="deleteDialog">
  <!-- N·ªôi dung dialog x√≥a -->
</dialog>

<!-- Load c√°c module JavaScript -->
<script src="core/data-manager.js"></script>
<script src="core/form-handler.js"></script>
<script src="core/table-renderer.js"></script>
<script src="core/camera-scanner.js"></script>
<script src="core/photo-handler.js"></script>
<script src="core/search-handler.js"></script>
<script src="core/category-tags.js"></script>
<script src="export-import/csv-handler.js"></script>
<script src="export-import/github-sync.js"></script>
<script src="export-import/shopify-export.js"></script>
<script src="export-import/kiotviet-export.js"></script>
<script src="export-import/kiotviet-sync.js"></script>
<script src="export-import/print-label.js"></script>
<script src="core/kiemkho-numpad.js?v1"></script>
<script src="core/kiemkho-keyboard.js?v=1"></script>

<script src="kiemkho-inline-edit.js?v02"></script>
<script src="app.js"></script>
</body>
</html>
